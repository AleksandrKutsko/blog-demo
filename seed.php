<?php
require_once __DIR__ . '/vendor/autoload.php';

use App\Config\Database;

// ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ Ğº Ğ‘Ğ”
$db = Database::getInstance();

try {
    // ĞÑ‡Ğ¸Ñ‰Ğ°ĞµĞ¼ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹
    $db->exec("SET FOREIGN_KEY_CHECKS = 0");
    $db->exec("TRUNCATE TABLE post_category");
    $db->exec("TRUNCATE TABLE posts");
    $db->exec("TRUNCATE TABLE categories");
    $db->exec("SET FOREIGN_KEY_CHECKS = 1");

    echo "ğŸ—‘ï¸ Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹ Ğ¾Ñ‡Ğ¸Ñ‰ĞµĞ½Ñ‹\n";

    // Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸
    $categories = [
        ['ĞĞ¾Ğ²Ğ¾ÑÑ‚Ğ¸', 'ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚Ğ¸ Ğ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ'],
        ['Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ğ¸', 'Ğ¡Ñ‚Ğ°Ñ‚ÑŒĞ¸ Ğ¾ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸ÑÑ… Ğ¸ Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğ¸'],
        ['ĞŸÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²Ğ¸Ñ', 'Ğ˜Ğ½Ñ‚ĞµÑ€ĞµÑĞ½Ñ‹Ğµ Ğ¼ĞµÑÑ‚Ğ° Ğ¸ ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ¿ÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¸ĞºĞ°Ğ¼'],
        ['ĞšÑƒĞ»Ğ¸Ğ½Ğ°Ñ€Ğ¸Ñ', 'Ğ’ĞºÑƒÑĞ½Ñ‹Ğµ Ñ€ĞµÑ†ĞµĞ¿Ñ‚Ñ‹ Ğ¸ ĞºÑƒĞ»Ğ¸Ğ½Ğ°Ñ€Ğ½Ñ‹Ğµ Ñ…Ğ¸Ñ‚Ñ€Ğ¾ÑÑ‚Ğ¸'],
        ['Ğ¡Ğ¿Ğ¾Ñ€Ñ‚', 'ĞĞ¾Ğ²Ğ¾ÑÑ‚Ğ¸ ÑĞ¿Ğ¾Ñ€Ñ‚Ğ° Ğ¸ Ğ·Ğ´Ğ¾Ñ€Ğ¾Ğ²Ñ‹Ğ¹ Ğ¾Ğ±Ñ€Ğ°Ğ· Ğ¶Ğ¸Ğ·Ğ½Ğ¸']
    ];

    $stmt = $db->prepare("INSERT INTO categories (title, description) VALUES (?, ?)");
    foreach ($categories as $cat) {
        $stmt->execute($cat);
    }
    echo "âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾ " . count($categories) . " ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹\n";

    // ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ ID ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹
    $categoryIds = $db->query("SELECT id FROM categories")->fetchAll(PDO::FETCH_COLUMN);

    // Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¿Ğ¾ÑÑ‚Ñ‹
    $posts = [
        [
            'ĞĞ¾Ğ²Ğ°Ñ Ğ²ĞµÑ€ÑĞ¸Ñ PHP 8.3 Ğ²Ñ‹ÑˆĞ»Ğ°!',
            'ĞĞ±Ğ·Ğ¾Ñ€ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚ĞµĞ¹ PHP 8.3',
            'ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹ Ğ¾Ğ±Ğ·Ğ¾Ñ€ Ğ²ÑĞµÑ… Ğ½Ğ¾Ğ²ÑˆĞµÑÑ‚Ğ² PHP 8.3: Ñ‚Ğ¸Ğ¿Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ ĞºĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚Ñ‹, ÑƒĞ»ÑƒÑ‡ÑˆĞµĞ½Ğ¸Ñ Randomizer, Ğ³Ğ»ÑƒĞ±Ğ¾ĞºĞ¸Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² JSON Ğ¸ Ğ¼Ğ½Ğ¾Ğ³Ğ¾Ğµ Ğ´Ñ€ÑƒĞ³Ğ¾Ğµ...',
            'php-8.3.jpg',
            150
        ],
        [
            'ĞšĞ°Ğº Ğ¿ÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ´ĞµÑˆĞµĞ²Ğ¾',
            'Ğ¡Ğ¾Ğ²ĞµÑ‚Ñ‹ Ğ´Ğ»Ñ ÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ½Ñ‹Ñ… Ğ¿ÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¸ĞºĞ¾Ğ²',
            '10 ÑĞ¿Ğ¾ÑĞ¾Ğ±Ğ¾Ğ² ÑÑĞºĞ¾Ğ½Ğ¾Ğ¼Ğ¸Ñ‚ÑŒ Ğ½Ğ° Ğ¿ÑƒÑ‚ĞµÑˆĞµÑÑ‚Ğ²Ğ¸ÑÑ…: ĞºĞ°Ğº Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ´ĞµÑˆĞµĞ²Ñ‹Ğµ Ğ±Ğ¸Ğ»ĞµÑ‚Ñ‹, Ğ³Ğ´Ğµ Ğ¸ÑĞºĞ°Ñ‚ÑŒ Ğ¶Ğ¸Ğ»ÑŒĞµ Ğ¸ ĞºĞ°Ğº Ğ¿Ğ¸Ñ‚Ğ°Ñ‚ÑŒÑÑ Ğ±ÑĞ´Ğ¶ĞµÑ‚Ğ½Ğ¾ Ğ² Ğ»ÑĞ±Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ°Ğ½Ğµ...',
            'travel-tips.jpg',
            320
        ],
        [
            'Ğ ĞµÑ†ĞµĞ¿Ñ‚ Ğ¸Ğ´ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ±Ğ¾Ñ€Ñ‰Ğ°',
            'Ğ¡ĞµĞºÑ€ĞµÑ‚Ñ‹ Ğ¿Ñ€Ğ¸Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ñ ÑƒĞºÑ€Ğ°Ğ¸Ğ½ÑĞºĞ¾Ğ³Ğ¾ Ğ±Ğ¾Ñ€Ñ‰Ğ°',
            'ĞŸĞ¾ÑˆĞ°Ğ³Ğ¾Ğ²Ñ‹Ğ¹ Ñ€ĞµÑ†ĞµĞ¿Ñ‚ Ñ Ñ„Ğ¾Ñ‚Ğ¾: ĞºĞ°Ğº Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾ ÑĞ²Ğ°Ñ€Ğ¸Ñ‚ÑŒ Ğ½Ğ°Ğ²Ğ°Ñ€Ğ¸ÑÑ‚Ñ‹Ğ¹ Ğ±Ğ¾Ñ€Ñ‰, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾Ğ½ Ğ±Ñ‹Ğ» ĞºÑ€Ğ°ÑĞ½Ñ‹Ğ¼ Ğ¸ Ğ²ĞºÑƒÑĞ½Ñ‹Ğ¼...',
            'borsh.jpg',
            89
        ],
        [
            'Docker Ğ´Ğ»Ñ Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ÑÑ‰Ğ¸Ñ…',
            'ĞŸĞ¾Ğ»Ğ½Ğ¾Ğµ Ñ€ÑƒĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ¾ Ğ¿Ğ¾ Docker',
            'Ğ’ÑÑ‘, Ñ‡Ñ‚Ğ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ·Ğ½Ğ°Ñ‚ÑŒ Ğ´Ğ»Ñ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ Ñ Docker: ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ°, Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹, ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Dockerfile Ğ¸ docker-compose...',
            'docker-guide.jpg',
            567
        ],
        [
            'Ğ¢Ğ¾Ğ¿-10 Ğ´Ğ¾ÑÑ‚Ğ¾Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ‡Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ĞµĞ¹ ĞŸĞ°Ñ€Ğ¸Ğ¶Ğ°',
            'Ğ§Ñ‚Ğ¾ Ğ¿Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ² ĞŸĞ°Ñ€Ğ¸Ğ¶Ğµ Ğ·Ğ° 3 Ğ´Ğ½Ñ',
            'Ğ“Ğ¸Ğ´ Ğ¿Ğ¾ Ğ³Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¼ Ğ¼ĞµÑÑ‚Ğ°Ğ¼ ĞŸĞ°Ñ€Ğ¸Ğ¶Ğ°: Ğ­Ğ¹Ñ„ĞµĞ»ĞµĞ²Ğ° Ğ±Ğ°ÑˆĞ½Ñ, Ğ›ÑƒĞ²Ñ€, ĞĞ¾Ñ‚Ñ€-Ğ”Ğ°Ğ¼ Ğ¸ ÑĞµĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğµ Ğ¼ĞµÑÑ‚ĞµÑ‡ĞºĞ¸, Ğ¾ ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… Ğ·Ğ½Ğ°ÑÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¼ĞµÑÑ‚Ğ½Ñ‹Ğµ...',
            'paris.jpg',
            234
        ]
    ];

    $stmt = $db->prepare("
        INSERT INTO posts (title, description, content, image_path, views) 
        VALUES (?, ?, ?, ?, ?)
    ");

    $postIds = [];
    foreach ($posts as $post) {
        $stmt->execute($post);
        $postIds[] = $db->lastInsertId();
    }
    echo "âœ… Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾ " . count($posts) . " ÑÑ‚Ğ°Ñ‚ĞµĞ¹\n";

    // Ğ¡Ğ²ÑĞ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ¾ÑÑ‚Ñ‹ Ñ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼Ğ¸
    $stmt = $db->prepare("INSERT INTO post_category (post_id, category_id) VALUES (?, ?)");

    foreach ($postIds as $index => $postId) {
        $numCategories = rand(1, min(3, count($categoryIds)));
        $randomKeys = array_rand(array_flip($categoryIds), $numCategories);
        $randomCategories = is_array($randomKeys) ? $randomKeys : [$randomKeys];

        foreach ($randomCategories as $catId) {
            $stmt->execute([$postId, $catId]);
        }
    }

    echo "âœ… Ğ¡Ñ‚Ğ°Ñ‚ÑŒĞ¸ ÑĞ²ÑĞ·Ğ°Ğ½Ñ‹ Ñ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼Ğ¸\n";
    echo "ğŸ‰ Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ·Ğ°Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ°!\n";

} catch (PDOException $e) {
    echo "âŒ ĞÑˆĞ¸Ğ±ĞºĞ°: " . $e->getMessage() . "\n";
    exit(1);
}